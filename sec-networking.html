<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Chapter 10. Networking</title><link rel="stylesheet" type="text/css" href="style.css" /><link rel="stylesheet" type="text/css" href="highlight/styles/monokai.css" /><script src="highlight/highlight.pack.js" type="text/javascript"></script><script src="highlight/init.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="NixOS Manual" /><link rel="up" href="ch-configuration.html" title="Part II. Configuration" /><link rel="prev" href="sec-x11.html" title="Chapter 9. X Window System" /><link rel="next" href="sec-kernel-config.html" title="Chapter 11. Linux Kernel" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 10. Networking</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="sec-x11.html">Prev</a> </td><th width="60%" align="center">Part II. Configuration</th><td width="20%" align="right"> <a accesskey="n" href="sec-kernel-config.html">Next</a></td></tr></table><hr /></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="sec-networking"></a>Chapter 10. Networking</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="sec-networking.html#sec-networkmanager">10.1. NetworkManager</a></span></dt><dt><span class="section"><a href="sec-networking.html#sec-ssh">10.2. Secure Shell Access</a></span></dt><dt><span class="section"><a href="sec-networking.html#sec-ipv4">10.3. IPv4 Configuration</a></span></dt><dt><span class="section"><a href="sec-networking.html#sec-ipv6">10.4. IPv6 Configuration</a></span></dt><dt><span class="section"><a href="sec-networking.html#sec-firewall">10.5. Firewall</a></span></dt><dt><span class="section"><a href="sec-networking.html#sec-wireless">10.6. Wireless Networks</a></span></dt><dt><span class="section"><a href="sec-networking.html#ad-hoc-network-config">10.7. Ad-Hoc Configuration</a></span></dt></dl></div><p>This section describes how to configure networking components on
your NixOS machine.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-networkmanager"></a>10.1. NetworkManager</h2></div></div></div><p>To facilitate network configuration, some desktop environments
use NetworkManager. You can enable NetworkManager by setting:

</p><pre class="programlisting">
networking.networkmanager.enable = true;
</pre><p>

some desktop managers (e.g., GNOME) enable NetworkManager
automatically for you.</p><p>All users that should have permission to change network settings
must belong to the <code class="code">networkmanager</code> group.</p><div class="note"><h3 class="title">Note</h3><p><code class="code">networking.networkmanager</code> and
<code class="code">networking.wireless</code> can not be enabled at the same time:
you can still connect to the wireless networks using
NetworkManager.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-ssh"></a>10.2. Secure Shell Access</h2></div></div></div><p>Secure shell (SSH) access to your machine can be enabled by
setting:

</p><pre class="programlisting">
services.openssh.enable = true;
</pre><p>

By default, root logins using a password are disallowed.  They can be
disabled entirely by setting
<code class="literal">services.openssh.permitRootLogin</code> to
<code class="literal">"no"</code>.</p><p>You can declaratively specify authorised RSA/DSA public keys for
a user as follows:


</p><pre class="programlisting">
users.extraUsers.alice.openssh.authorizedKeys.keys =
  [ "ssh-dss AAAAB3NzaC1kc3MAAACBAPIkGWVEt4..." ];
</pre><p>

</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-ipv4"></a>10.3. IPv4 Configuration</h2></div></div></div><p>By default, NixOS uses DHCP (specifically,
<span class="command"><strong>dhcpcd</strong></span>) to automatically configure network
interfaces.  However, you can configure an interface manually as
follows:

</p><pre class="programlisting">
networking.interfaces.eth0.ip4 = [ { address = "192.168.1.2"; prefixLength = 24; } ];
</pre><p>

Typically you’ll also want to set a default gateway and set of name
servers:

</p><pre class="programlisting">
networking.defaultGateway = "192.168.1.1";
networking.nameservers = [ "8.8.8.8" ];
</pre><p>

</p><div class="note"><h3 class="title">Note</h3><p>Statically configured interfaces are set up by the systemd
service
<em class="replaceable"><code>interface-name</code></em><code class="literal">-cfg.service</code>.
The default gateway and name server configuration is performed by
<code class="literal">network-setup.service</code>.</p></div><p>The host name is set using <code class="option">networking.hostName</code>:

</p><pre class="programlisting">
networking.hostName = "cartman";
</pre><p>

The default host name is <code class="literal">nixos</code>.  Set it to the
empty string (<code class="literal">""</code>) to allow the DHCP server to
provide the host name.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-ipv6"></a>10.4. IPv6 Configuration</h2></div></div></div><p>IPv6 is enabled by default.  Stateless address autoconfiguration
is used to automatically assign IPv6 addresses to all interfaces.  You
can disable IPv6 support globally by setting:

</p><pre class="programlisting">
networking.enableIPv6 = false;
</pre><p>

</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-firewall"></a>10.5. Firewall</h2></div></div></div><p>NixOS has a simple stateful firewall that blocks incoming
connections and other unexpected packets.  The firewall applies to
both IPv4 and IPv6 traffic. It is enabled by default. It can be
disabled as follows:

</p><pre class="programlisting">
networking.firewall.enable = false;
</pre><p>

If the firewall is enabled, you can open specific TCP ports to the
outside world:

</p><pre class="programlisting">
networking.firewall.allowedTCPPorts = [ 80 443 ];
</pre><p>

Note that TCP port 22 (ssh) is opened automatically if the SSH daemon
is enabled (<code class="option">services.openssh.enable = true</code>).  UDP
ports can be opened through
<code class="option">networking.firewall.allowedUDPPorts</code>.  Also of
interest is

</p><pre class="programlisting">
networking.firewall.allowPing = true;
</pre><p>

to allow the machine to respond to ping requests.  (ICMPv6 pings are
always allowed.)</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-wireless"></a>10.6. Wireless Networks</h2></div></div></div><p>For a desktop installation using NetworkManager (e.g., GNOME),
you just have to make sure the user is in the
<code class="code">networkmanager</code> group and you can skip the rest of this
section on wireless networks.</p><p>
NixOS will start wpa_supplicant for you if you enable this setting:

</p><pre class="programlisting">
networking.wireless.enable = true;
</pre><p>

NixOS currently does not generate wpa_supplicant's
configuration file, <code class="literal">/etc/wpa_supplicant.conf</code>. You should edit this file
yourself to define wireless networks, WPA keys and so on (see
wpa_supplicant.conf(5)).
</p><p>
If you are using WPA2 the <span class="command"><strong>wpa_passphrase</strong></span> tool might be useful
to generate the <code class="literal">wpa_supplicant.conf</code>.

</p><pre class="screen">
$ wpa_passphrase ESSID PSK &gt; /etc/wpa_supplicant.conf</pre><p>

After you have edited the <code class="literal">wpa_supplicant.conf</code>,
you need to restart the wpa_supplicant service.

</p><pre class="screen">
$ systemctl restart wpa_supplicant.service</pre><p>
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ad-hoc-network-config"></a>10.7. Ad-Hoc Configuration</h2></div></div></div><p>You can use <code class="option">networking.localCommands</code> to specify
shell commands to be run at the end of
<code class="literal">network-setup.service</code>.  This is useful for doing
network configuration not covered by the existing NixOS modules.  For
instance, to statically configure an IPv6 address:

</p><pre class="programlisting">
networking.localCommands =
  ''
    ip -6 addr add 2001:610:685:1::1/64 dev eth0
  '';
</pre><p>

</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sec-x11.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch-configuration.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="sec-kernel-config.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 9. X Window System </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 11. Linux Kernel</td></tr></table></div></body></html>